#region BluePrint.Calculator, Copyright 2005 BluePrint Work Group, Programmed by Tony Qu
/* ************************************************************
 项目名称：科学计算器
 实现语言：C#
 作者：Tony Qu
 作者博客：http://www.cnblogs.com/tonyqus
 模块名称：文法分析器
 模块命名空间：GrammerAnalyzer
 当前文件信息：GrammerAnalyzer.Operator，算符相关操作
 目前版本：1.0.1.0
 
 当前文件修订  
	Who			Date			Version			Comment
	Tony Qu		2005.5.4		1.0.0.0			对原来的一些冗余代码进行整理，汇集起来创建了该类
	Tony Qu		2005.5.13		1.0.1.0			加入了绝对优先级表和相对优先级表
*************************************************************/
#endregion  

using System;
using PhraseAnalyzer;

namespace GrammerAnalyzer
{
	/// <summary>
	/// 算符类
	/// </summary>
	public class Operator
	{
		//绝对优先级表
		private static int[,] _priorityTable=
		{
			//0,1,2,...，每10个一空
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//unknown
			{0,2,2,0,0,0,2,2,0,0, 2,2,2,2,2,2,2,2,0,0, 0,0,0,0,2,2,2,0,0,2, 2,2,2,2,2,2,2,2,0},	//ln
			{0,2,2,0,0,0,2,2,0,0, 2,2,2,2,2,2,2,2,0,0, 0,0,0,0,2,2,2,0,0,2, 2,2,2,2,2,2,2,2,0},	//lg
			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//log
			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//pow

			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//reserved
			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//cbrt
			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//sbrt
			{0,0,0,0,0,0,0,0,1,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,1}, //!
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//reserved

			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//sin
			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//cos
			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//asin
			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//acos
			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//tg

			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//ctg
			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//atg
			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//actg
			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//plus
			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//minus

			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//time
			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,2,2,2,0,0,2,2, 2,2,2,2,2,2,2,2,0},	//divide
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,2,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//reserved
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,2,2,2,0,0,2, 2,2,2,2,2,2,2,2,0},	//mod
			{0,2,2,0,0,0,2,2,0,2, 2,2,2,2,2,2,2,2,0,0, 0,0,0,0,2,3,2,0,0,2, 2,2,2,2,2,2,2,2,0},	//(

			{0,0,0,1,1,0,0,0,1,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//)
			{0,0,0,1,1,0,0,0,1,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,1},	//ans
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//sto
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,1},	//clr
			{0,0,0,1,1,0,0,0,1,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,1},	//ax

			{0,0,0,1,1,0,0,0,1,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,1},	//bx
			{0,0,0,1,1,0,0,0,1,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,1},	//cx
			{0,0,0,1,1,0,0,0,1,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,1},	//dx
			{0,0,0,1,1,0,0,0,1,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,1},	//ex
			{0,0,0,1,1,0,0,0,1,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,1},	//fx

			{0,0,0,1,1,0,0,0,1,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,1},	//e
			{0,0,0,1,1,0,0,0,1,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,1},	//pi
			{0,0,0,1,1,0,0,0,1,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,1},	//number
			{0,2,2,2,2,0,2,2,2,2, 2,2,2,2,2,2,2,2,2,2, 2,2,0,2,2,2,0,2,2,2, 2,2,2,2,2,2,2,2,3}	//sharp
		};
		//相对优先级表
		private static int[,] _priorityTable2=
		{
			//0,1,2,...，每10个一空
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//unknown
			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,1,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//ln
			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,1,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//lg
			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,1,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//log
			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,1,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//pow

			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//reserved
			{0,2,2,0,0,0,2,2,0,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,0,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//cbrt
			{0,2,2,0,0,0,2,2,0,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,0,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//sbrt
			{0,0,0,0,0,0,0,0,1,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,1}, //!
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//reserved

			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,0,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//sin
			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,0,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//cos
			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,0,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//asin
			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,0,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//acos
			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,0,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//tg

			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,0,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//ctg
			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,0,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//atg
			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,0,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//actg
			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 2,2,0,2,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//plus
			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 2,2,0,2,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//minus

			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,2,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//time
			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,1,1, 1,1,0,2,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//divide
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//reserved
			{0,0,0,0,0,0,0,0,2,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,0,2,1,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//mod
			{0,2,2,2,2,0,2,2,2,0, 2,2,2,2,2,2,2,2,2,2, 2,2,0,2,2,3,2,0,0,0, 0,0,0,0,0,0,0,0,1},	//(

			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//)
			{0,0,0,1,1,0,0,0,1,0, 0,0,0,0,0,0,0,0,1,1, 1,1,0,1,0,1,0,0,0,0, 0,0,0,0,0,0,0,0,1},	//ans
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//sto
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//clr
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//ax

			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//bx
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//cx
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//dx
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//ex
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//fx

			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//e
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//pi
			{0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0},	//number
			{0,2,2,2,2,0,2,2,2,2, 2,2,2,2,2,2,2,2,2,2, 2,2,0,2,2,2,0,2,2,2, 2,2,2,2,2,2,2,2,3}	//sharp
		};


		/// <summary>
		/// 根据运算符返回对应的运算目数
		/// </summary>
		/// <param name="Phrase">运算符</param>
		/// <returns>运算目数</returns>
		public static OperandType OperandCount(PhraseType pt)
		{
			//分析运算符的目数
			if(pt==PhraseType.cos||pt==PhraseType.sin||pt==PhraseType.asin||
				pt==PhraseType.acos||pt==PhraseType.acos||pt==PhraseType.actg||
				pt==PhraseType.atg||pt==PhraseType.cbrt||pt==PhraseType.sbrt||
				pt==PhraseType.lg||pt==PhraseType.ln||pt==PhraseType.tg||pt==PhraseType.ctg||pt==PhraseType.fact)
				return OperandType.O1;
			else if(pt==PhraseType.divide||pt==PhraseType.plus||pt==PhraseType.minus||
				pt==PhraseType.mutiple||pt==PhraseType.pow||pt==PhraseType.mod||pt==PhraseType.log)
				return OperandType.O2;
			else
				return OperandType.O0;
		}
		/// <summary>
		/// 根据词的类型返回优先级（不用）
		/// </summary>
		/// <param name="pt">词类</param>
		/// <returns>优先级</returns>
		public static OperatorPriority GetPriority(PhraseType pt)
		{
			if(pt==PhraseType.ln||pt==PhraseType.log||pt==PhraseType.lg)
				return OperatorPriority.P5;
			else if(pt==PhraseType.sin||pt==PhraseType.cos||pt==PhraseType.tg||
				pt==PhraseType.ctg||pt==PhraseType.asin||pt==PhraseType.acos||
				pt==PhraseType.atg||pt==PhraseType.actg)
				return OperatorPriority.P4;
			else if(pt==PhraseType.pow)
				return OperatorPriority.P6;
			else if(pt==PhraseType.plus)
				return OperatorPriority.P1;
			else if(pt==PhraseType.minus)
				return OperatorPriority.P1;
			else if(pt==PhraseType.mutiple)
				return OperatorPriority.P2;
			else if(pt==PhraseType.mod||pt==PhraseType.divide)
				return OperatorPriority.P2;
			else if(pt==PhraseType.leftbracket)
				return OperatorPriority.P0;
			else if(pt==PhraseType.sharp)
				return OperatorPriority.P0;
			else
				return OperatorPriority.Unknown;
		}
		/// <summary>
		/// 前后邻近符号（包括运算符和数符）比较
		/// </summary>
		/// <param name="prePt">前一个符号</param>
		/// <param name="postPt">后一个符号</param>
		/// <returns>优先级比较值</returns>
		public static PriorityCmpType OperatorCmp(PhraseType prePt,PhraseType postPt)
		{
			int result=_priorityTable[(int)prePt,(int)postPt];
			return (PriorityCmpType)result;
		}
		/// <summary>
		/// 有间隔相邻符号比较（只包含数符）
		/// </summary>
		/// <param name="prePt">前一个符号</param>
		/// <param name="postPt">后一个符号</param>
		/// <returns>优先级比较值</returns>
		public static PriorityCmpType OperatorCmp2(PhraseType prePt,PhraseType postPt)
		{
			int result=_priorityTable2[(int)prePt,(int)postPt];
			return (PriorityCmpType)result;
		}

	}
}
